
        <p-toolbar styleClass="mb-6">
     <ng-template #start>
<form [formGroup]="productForm" (ngSubmit)="onSaveProduct()">
    <div class="p-4">
        <!-- Form Header -->
        <div class="mb-4">
            <h3 class="text-xl font-semibold text-gray-800 mb-2">Product Information</h3>
            <p class="text-sm text-gray-600">Enter product details for inventory management</p>
        </div>

        <!-- Form Grid Layout -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            
            <!-- Vendor Name -->
            <div class="flex flex-col">
                <label class="text-sm font-medium text-gray-700 mb-2">
                    Vendor Name <span class="text-red-500">*</span>
                </label>
                <p-iconfield iconPosition="left">
                    <p-inputicon class="pi pi-building"></p-inputicon>
                     <p-select [class.ng-invalid]="vendorName?.invalid && vendorName?.touched" formControlName="vendorName" [options]="allVendors" optionLabel="name"
  optionValue="id" placeholder="Enter vendor name" />

                  
                </p-iconfield>
                <!-- Error Message -->
                <small class="text-red-500 mt-1" *ngIf="vendorName?.invalid && vendorName?.touched">
                    <span *ngIf="vendorName?.errors?.['required']">Vendor name is required</span>
                    <span *ngIf="vendorName?.errors?.['minlength']">Vendor name must be at least 2 characters</span>
                </small>
            </div>

            <!-- Date -->
            <div class="flex flex-col">
                <label class="text-sm font-medium text-gray-700 mb-2">
                    Purchase Date <span class="text-red-500">*</span>
                </label>
                <p-iconfield iconPosition="left">
                    <p-inputicon class="pi pi-calendar"></p-inputicon>
                    <p-datepicker 
                        formControlName="purchaseDate"
                        [showIcon]="true" 
                        [showButtonBar]="true"
                        placeholder="Select purchase date"
                        class="w-full"
                        [class.ng-invalid]="purchaseDate?.invalid && purchaseDate?.touched">
                    </p-datepicker>
                </p-iconfield>
                <!-- Error Message -->
                <small class="text-red-500 mt-1" *ngIf="purchaseDate?.invalid && purchaseDate?.touched">
                    <span *ngIf="purchaseDate?.errors?.['required']">Purchase date is required</span>
                </small>
            </div>

            <!-- Vendor Invoice No -->
            <div class="flex flex-col">
                <label class="text-sm font-medium text-gray-700 mb-2">
                    Invoice Number <span class="text-red-500">*</span>
                </label>
                <p-iconfield iconPosition="left">
                    <p-inputicon class="pi pi-file-text"></p-inputicon>
                    <input pInputText 
                           formControlName="invoiceNumber"
                           type="text" 
                           placeholder="Enter invoice number"
                           class="w-full"
                           [class.ng-invalid]="invoiceNumber?.invalid && invoiceNumber?.touched" />
                </p-iconfield>
                <!-- Error Message -->
                <small class="text-red-500 mt-1" *ngIf="invoiceNumber?.invalid && invoiceNumber?.touched">
                    <span *ngIf="invoiceNumber?.errors?.['required']">Invoice number is required</span>
                    <span *ngIf="invoiceNumber?.errors?.['minlength']">Invoice number must be at least 3 characters</span>
                </small>
            </div>  

            <!-- Product Code -->
            <div class="flex flex-col">
                <label class="text-sm font-medium text-gray-700 mb-2">
                    Product Code <span class="text-red-500">*</span>
                </label>
                <p-iconfield iconPosition="left">
                    <p-inputicon class="pi pi-barcode" 
                                 ></p-inputicon>
                    <input pInputText 
                           formControlName="productCode"
                           type="text" 
                           placeholder="Enter product code"
                          (keydown.enter)="getProduct()"
                           class="w-full"
                         
                           />
                </p-iconfield>
                <!-- Disabled Message -->
                <small class="text-gray-500 mt-1" *ngIf="isProductFieldsDisabled">
                    Enter vendor name first to enable this field
                </small>
                <!-- Error Message -->
                <small class="text-red-500 mt-1" *ngIf="productCode?.invalid && productCode?.touched && !isProductFieldsDisabled">
                    <span *ngIf="productCode?.errors?.['required']">Product code is required</span>
                    <span *ngIf="productCode?.errors?.['minlength']">Product code must be at least 3 characters</span>
                </small>
            </div>

            <!-- Quantity -->
            <div class="flex flex-col">
                <label class="text-sm font-medium text-gray-700 mb-2">
                    Quantity <span class="text-red-500">*</span>
                </label>
                <p-iconfield iconPosition="left">
                    <p-inputicon class="pi pi-box" 
                                 [class.opacity-50]="isProductFieldsDisabled"></p-inputicon>
                    <input pInputText 
                           formControlName="quantity"
                           type="number" 
                           placeholder="Enter quantity"
                           class="w-full"
                           [class.ng-invalid]="quantity?.invalid && quantity?.touched"
                           [class.opacity-50]="isProductFieldsDisabled" />
                </p-iconfield>
                <!-- Disabled Message -->
                <small class="text-gray-500 mt-1" *ngIf="isProductFieldsDisabled">
                    Enter vendor name first to enable this field
                </small>
                <!-- Error Message -->
                <small class="text-red-500 mt-1" *ngIf="quantity?.invalid && quantity?.touched && !isProductFieldsDisabled">
                    <span *ngIf="quantity?.errors?.['required']">Quantity is required</span>
                    <span *ngIf="quantity?.errors?.['min']">Quantity must be at least 1</span>
                </small>
            </div>

            <!-- Purchase Price -->
            <div class="flex flex-col">
                <label class="text-sm font-medium text-gray-700 mb-2">
                    Purchase Price <span class="text-red-500">*</span>
                </label>
                <p-iconfield iconPosition="left">
                    <p-inputicon class="pi pi-dollar" 
                                 [class.opacity-50]="isProductFieldsDisabled"></p-inputicon>
                    <input pInputText 
                           formControlName="purchasePrice"
                           type="number" 
                           step="0.01"
                           placeholder="Enter purchase price"
                           class="w-full"
                           [class.ng-invalid]="purchasePrice?.invalid && purchasePrice?.touched"
                           [class.opacity-50]="isProductFieldsDisabled" />
                </p-iconfield>
                <!-- Disabled Message -->
                <small class="text-gray-500 mt-1" *ngIf="isProductFieldsDisabled">
                    Enter vendor name first to enable this field
                </small>
                <!-- Error Message -->
                <small class="text-red-500 mt-1" *ngIf="purchasePrice?.invalid && purchasePrice?.touched && !isProductFieldsDisabled">
                    <span *ngIf="purchasePrice?.errors?.['required']">Purchase price is required</span>
                    <span *ngIf="purchasePrice?.errors?.['min']">Purchase price must be greater than 0</span>
                </small>
            </div>

        </div>

        <!-- Form Status Indicator -->
        <div class="mt-4 p-3 rounded-lg" [class]="productForm.valid ? 'bg-green-50 border border-green-200' : 'bg-yellow-50 border border-yellow-200'">
            <div class="flex items-center">
                <i class="mr-2" [class]="productForm.valid ? 'pi pi-check-circle text-green-600' : 'pi pi-exclamation-triangle text-yellow-600'"></i>
                <span class="text-sm font-medium" [class]="productForm.valid ? 'text-green-800' : 'text-yellow-800'">
                    {{ productForm.valid ? 'Form is complete and ready to save' : 'Please fill in all required fields' }}
                </span>
            </div>
            <div class="mt-2 text-xs" [class]="productForm.valid ? 'text-green-600' : 'text-yellow-600'">
                {{ !vendorName?.value ? 'Start by entering the vendor name to unlock product fields' : 
                   productForm.valid ? 'All validations passed' : 'Some fields need attention' }}
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="flex justify-end gap-3 mt-6 pt-4 border-t border-gray-200">
            <p-button 
                label="Clear" 
                icon="pi pi-times" 
                severity="secondary" 
                [outlined]="true"
                type="button"
                (onClick)="onClear()">
            </p-button>
            <p-button 
                label="add " 
                icon="pi pi-check" 
                severity="success"
                type="submit"
                [disabled]="isSaveDisabled"
                [class.opacity-50]="isSaveDisabled">
            </p-button>
        </div>

    </div>
</form>
</ng-template>
          <ng-template #end>
    <div class="max-w-4xl mx-auto ">
        <!-- Header Section -->
      

        <!-- Main Content Card -->
        <div class="bg-white border border-gray-200 rounded-b-lg shadow-lg">
            
            <!-- Product Information Grid -->
            <div class="p-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    
                    <!-- Left Column - Product Details -->
                    <div class="space-y-4">
                        
                        <!-- Product Name -->
                        <div class="border-b border-gray-100 pb-3">
                            
                            <p class="text-lg font-medium text-gray-900">{{productInfo?.name}}</p>
                        </div>

                        <!-- Sale Price -->
                        <div class="border-b border-gray-100 pb-3">
                            <div class="flex items-center mb-2">
                                <i class="pi pi-dollar text-green-600 mr-2"></i>
                                <label class="text-sm font-semibold text-gray-600 uppercase tracking-wide">Sale Price</label>
                            </div>
                            <p class="text-2xl font-bold text-green-600">Rs. {{productInfo?.price}}</p>
                        </div>

                        <!-- Category -->
                        <div class="border-b border-gray-100 pb-3">
                            <div class="flex items-center mb-2">
                                <i class="pi pi-th-large text-purple-600 mr-2"></i>
                                <label class="text-sm font-semibold text-gray-600 uppercase tracking-wide">Category</label>
                            </div>
                            <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-purple-100 text-purple-800">
                                {{productInfo?.category?.name || 'Uncategorized'}}
                            </span>
                        </div>

                        <!-- Description -->
                        <div>
                            <div class="flex items-center mb-2">
                                <i class="pi pi-info-circle text-gray-600 mr-2"></i>
                                <label class="text-sm font-semibold text-gray-600 uppercase tracking-wide">Description</label>
                            </div>
                            <p class="text-gray-700 leading-relaxed">
                                {{productInfo?.description}} 
                            </p>
                        </div>

                    </div>

                    <!-- Right Column - Barcode Section -->
                    <div class="flex flex-col items-center justify-center">
                        
                        <!-- Barcode Card -->
                        <div class="w-full max-w-sm">
                            <div class="bg-gray-50 border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                                
                                <!-- Barcode Header -->
                                <div class="mb-4">
                                    <h3 class="text-lg font-semibold text-gray-800 mb-2">Product Barcode</h3>
                                    <p class="text-sm text-gray-600">Scan for quick identification</p>
                                </div>

                                <!-- Barcode Image -->
                                <div class="bg-white p-4 rounded-lg border shadow-sm mb-4">
                                    <img [src]="barcodeBase64" 
                                         alt="Generated Barcode" 
                                         class="mx-auto max-w-full h-auto" />
                                </div>

                                <!-- Barcode Actions -->
                                <div class="flex flex-col sm:flex-row gap-2 justify-center">                                    
                                    <button class="flex items-center justify-center px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors text-sm font-medium">
                                        <i class="pi pi-print mr-2"></i>
                                        Print
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Additional Info Cards -->
                        <div class="w-full max-w-sm mt-6 space-y-3">
  
                            <!-- SKU Info -->
                            <div class="bg-blue-50 border border-blue-200 rounded-lg p-3">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center">
                                        <i class="pi pi-barcode text-blue-600 mr-2"></i>
                                        <span class="text-sm font-medium text-blue-800">SKU</span>
                                    </div>
                                    <span class="text-sm font-mono text-blue-600">{{productInfo?.productCode}} </span>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>

            <!-- Footer Actions -->
          

        </div>
    </div>
</ng-template>
        </p-toolbar>

        <p-table
            #dt
            [value]="productpurchase"
            [rows]="10"
            [columns]="cols"
            [paginator]="false"
            [globalFilterFields]="['name', 'country.name', 'representative.name', 'status']"
            [tableStyle]="{ 'min-width': '75rem' }"
            [(selection)]="selectedProducts"
            [rowHover]="true"
            dataKey="id"
            currentPageReportTemplate="Showing {first} to {last} of {totalRecords} products"
            [showCurrentPageReport]="true"
            [rowsPerPageOptions]="[10, 20, 30]"
        >
            <ng-template #caption>
                <div class="flex items-center justify-between">
                    <h5 class="m-0">Invoice Detail</h5>
                    <p-iconfield>
                        <p-inputicon styleClass="pi pi-search" />
                        <input pInputText type="text" (input)="onGlobalFilter(dt, $event)" placeholder="Search..." />
                    </p-iconfield>
                </div>
            </ng-template>
           
            <ng-template #header>
                <tr>
               
                  
                    <th style="min-width: 16rem">Code</th>
                    <th pSortableColumn="name" style="min-width:16rem">
                        Name
                        <p-sortIcon field="name" />
                    </th>
                   
                    <th pSortableColumn="price" style="min-width: 8rem">
                       Sale Price
                        <p-sortIcon field="price" />
                    </th>
                      <th pSortableColumn="name" style="min-width:16rem">
                        Quntity
                        <p-sortIcon field="name" />
                    </th>
                        <th pSortableColumn="name" style="min-width:16rem">
                        Total price
                        <p-sortIcon field="name" />
                    </th>
                        <th pSortableColumn="name" style="min-width:16rem">
                        Avg price
                        <p-sortIcon field="name" />
                    </th>
                 
                  
                    <th style="min-width: 12rem"></th>
                </tr>
            </ng-template>
            <ng-template #body let-product>
                <tr>
                  
                    <td style="min-width: 12rem">{{ product.productCode }}</td>
                    <td style="min-width: 12rem">{{ product.name }}</td>
                    <td>{{ product.saleprice | currency: 'USD' }}</td>
                    <td>{{ product.quantity}}</td>
                      <td>{{ product.purchasePrice }}</td>
                         <td>{{ product.purchasePrice}}</td>
                  
                    <td>


                        <p-button icon="pi pi-pencil" class="mr-2" [rounded]="true" [outlined]="true" (click)="editProduct(product)" />
                        <p-button icon="pi pi-trash" severity="danger" [rounded]="true" [outlined]="true" (click)="deleteProduct(product)" />
                    </td>
                </tr>
            </ng-template>
       
        </p-table>

   <p-table

        >
            <ng-template #caption>
                <div class="flex items-center justify-between">
             
                   
                </div>
            </ng-template>
           
            <ng-template #header>
                <tr>
               
                  
                    <th style="min-width: 16rem"></th>
                    <th  style="min-width:16rem">
                        
                
                    </th>
                   
                    <th  style="min-width: 8rem">
                    
                        
                    </th>
                      <th style="min-width:16rem">
                        Quntity: {{sumQuantities()}}
                    </th>
                        <th  style="min-width:16rem">
                        Total price : {{sumTotal()}}
                    </th>
                 
                  
                    <th style="min-width: 12rem"> <p-button (click)="SaveInoice()" label="Save Invoice" severity="success" /></th>
                </tr>
            </ng-template>
            <ng-template #body let-product>
                <tr>
                  
                    <td style="min-width: 12rem"></td>
                    <td style="min-width: 12rem"></td>
                    <td>{{ product?.price | currency: 'USD' }}</td>
                    <td>dcs</td>
                      <td>{{ product?.purchasePrice }}</td>
                         <td>{{ product|json }}</td>
                  
                    <td>


                        <p-button icon="pi pi-pencil" class="mr-2" [rounded]="true" [outlined]="true" (click)="editProduct(product)" />
                        <p-button icon="pi pi-trash" severity="danger" [rounded]="true" [outlined]="true" (click)="deleteProduct(product)" />
                    </td>
                </tr>
            </ng-template>
       
        </p-table>

        <p-confirmdialog [style]="{ width: '450px' }" />



        
   